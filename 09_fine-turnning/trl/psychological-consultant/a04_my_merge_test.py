import torch
import pandas as pd
from a00_constant import *
from a02_my_model import MyModel
from transformers import pipeline, AutoTokenizer, AutoModelForCausalLM, TextStreamer

class MyMerge(MyModel):
    def __init__(self):
        model, tokenizer = self.load_model_tokenizer()
        self.streamer = TextStreamer(tokenizer)
        self.pipeline = pipeline(
            task = "text-generation",
            model = model,
            tokenizer = tokenizer,
            device_map = "auto"
        )

    def load_model_tokenizer(self):
        tokenizer = AutoTokenizer.from_pretrained(adapter_dir)
        model: AutoModelForCausalLM = AutoModelForCausalLM.from_pretrained(
            model_dir,
            # torch_dtype = torch.float16,
            device_map = "auto"
        )
        model.load_adapter(adapter_dir)
        return model, tokenizer
    
    # def generate(self, message):
    #     return self.pipeline(message)
    

if __name__ == "__main__":
    question1 = "我晚上难以入睡，我认为这是因为我对工作感到压力" 
    # 嗯，用户说他晚上难以入睡，认为是因为工作压力。首先，我需要确认他的情况是否常见，以及可能的解决方法。工作压力导致的失眠确实很普遍，但每个人的具体情况可能不同。我需要考虑他的工作环境、压力源是什么，比如工作量、人际关系还是职业发展。然后，可能涉及到他的睡前习惯，是否有使用电子设备、咖啡因摄入等影响睡眠的因素。此外，心理健康方面，比如焦虑或抑郁情绪也可能加剧失眠。我需要建议他调整作息，比如建立规律的睡眠时间，避免咖啡因和蓝光。放松技巧如冥想、深呼吸可能会有帮助。如果自我调节无效，可能需要建议他寻求专业帮助，比如心理咨询师或医生。同时，时间管理技巧可能减轻工作压力，比如任务优先级划分，适当授权任务。还要注意他的支持系统，比如家人朋友的支持。需要提醒他如果症状持续，可能有更严重的健康问题，应该及时就医。最后，要确保建议具体可行，并且语气要 empathetic，让他感受到被理解和支持。
    """
    你的情况是很多职场人都会遇到的困扰，工作压力导致的失眠往往是一个恶性循环：压力影响睡眠质量，睡眠不足又导致次日工作效率降低，进一步加重压力。以下是一些针对性建议，希望能帮助你逐步打破这个循环：

        **第一步：建立压力档案（当晚即可操作）**
        1. 准备笔记本记录：
        - 具体压力事件（如"明早要向董事会汇报"）
        - 伴随的生理反应（手心出汗/心跳加速）
        - 脑海中的具体担忧（"忘词怎么办？数据记错怎么办？"）
        - 实际发生概率（用百分比标注，如"忘词概率约20%"）

        **第二步：90分钟睡眠周期调整法（3天内见效）**
        - 计算就寝时间：设定起床时间后倒推1.5小时的整数倍
        - 例：若需7点起床，可尝试11:30或1:00入睡
        - 使用SleepCycle等APP监测睡眠质量

        **第三歩：办公室微放松（工作中随时可用）**
        - 4-7-8呼吸法：吸气4秒→屏息7秒→呼气8秒（
        - 桌面减压神器：备握力球/指尖陀螺，在接电话时使用
        - 视觉放松：将电脑桌面换成动态自然景观（推荐Rainy Mood网站）

        **进阶方案：压力转化训练（需1-2周练习）**
        1. 压力具象化练习：
        - 每天花5分钟将压力想象成具体物体（如不断膨胀的气球）
        - 在脑海中为这个"压力球"设置安全阀，想象缓慢释放过程

        2. 焦虑时段专用笔记本：
        - 设定"焦虑时间"（如晚8-8:30）
        - 其他时间出现担忧时快速记录关键词，留到专用时段处理

        **重要提醒：**
        若出现以下情况建议立即就医：
        - 连续3天睡眠不足4小时
        - 出现心悸/手抖等躯体症状
        - 对原本爱好完全失去兴趣

    建议从今晚开始尝试"压力档案"记录，很多时候当我们把模糊的焦虑具体化后，它的压迫感就会明显减弱。这个过程可能需要持续记录3-5天才能看到明显效果，请给自己足够的耐心。记住，你不需要完美解决所有压力源，重点在于重建对压力的掌控感。
    """
    # question2 = "下列关于细胞呼吸在生产生活中应用的叙述，错误的是  （    ） A. 给含有酵母菌的发酵液连续通气可以提高产酒量 B. 适当降低温度和氧浓度有利于果蔬储藏 C. 利用乳酸细菌制作酸奶过程中需密闭隔绝空气 D. 黑暗条件下绿豆萌发成豆芽的过程中有机物总量不断减少"
    # A /n【解析】呼吸作用的影响因素有：氧气、温度等。 【详解】酵母菌是兼性厌氧型生物，发酵初期需要氧气进行增殖，后期需要在无氧条件下进行酒精发酵，A错误；果蔬储藏时应该降低呼吸作用消耗，应该在低温和低氧条件下进行，B正确；乳酸菌是厌氧型生物，乳酸发酵时需要处于无氧环境中，C正确；黑暗下，豆芽只能进行呼吸作用，不能进行光合作用，故有机物总量会下降，D正确。故选A。
    # question3 = "下列关于生命系统中的信息传递的叙述，正确的是  （    ） A. 细胞内的遗传信息传递方式:DNARNA蛋白质（性状） B. 细胞间通过激素、神经递质实现其全部信息传递 C. 在兔→狐过程中，物质、能量从兔到狐单向传递，而信息却是双向传递的 D. 生态系统中信息传递发生在同种生物或不同种生物之间，并能调节种间关系"
    # C /n【解析】分析：细胞生物中遗传信息可以从DNA流向DNA，也可以从DNA流向RNA，进而流向蛋白质，在某些病毒中遗传信息可以从RNA流向RNA以及从RNA流向DNA。细胞间的信息交流主要有三种方式：①通过化学物质来传递信息，如激素；②通过细胞膜直接接触传递信息，如精卵识别；③通过细胞通道来传递信息，如高等植物细胞之间通过胞间连丝相互连接。生态系统中信息的类型包括物理信息、化学信息、行为信息，信息传递在生态系统中的作用主要体现在以下三方面：生态系统中生命活动的正常进行，离不开信息的作用；生物种群的繁衍，也离不开信息的传递；信息还能够调节生物的种间关系，维持生态系统稳定。 详解：A. 生物体细胞中，传递遗传信息传递途径有DNA→DNA即DNA的复制，也有DNA→RNA→蛋白质即转录和翻译，A错误；B. 细胞间的信息传递，除了通过激素，神经递质外，还可通过细胞膜上的糖蛋白传递信息，植物细胞间还可以形成胞间连丝实现信息传递，B错误； C. 物质和能量沿食物链单向传递，捕食过程中捕食者和被捕食者之间的信息传递是双向的，如狼可根据兔子留下的气味捕食后者，兔子同样也能依据狼的气味或行为特征躲避捕食，C正确；D. 信息传递既可以发生在生物与生物之间，也可以发生在生物与环境之间，如植物开花需要光信息和日照时间达到一定长度，这些物理信息即来自无机环境，D错误。 点睛：本题考查中心法则及其发展、细胞膜的功能、生态系统中的信息传递，要求考生识记中心法则的主要内容及后人对其进行的补充和完善；同时识记细胞膜的信息交流功能；掌握生态系统中信息传递在生产实践中的应用，能应用所学的知识准确判断各选项。
    my_merge = MyMerge()
    my_merge.generate(question1)
    print("--" * 10)
    # my_merge.generate(question2)
    print("--" * 10)
    # my_merge.generate(question3)